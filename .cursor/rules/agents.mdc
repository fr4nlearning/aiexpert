---
alwaysApply: true
---

- nunca guardes los cambios sin mi consentimiento explicito
- compila: ./gradle clean build

# Cursor Rule: Gestión de GitHub a partir de 03-tasks.md

Este documento define cómo debe actuar Cursor para manejar GitHub (issues, ramas, commits y PRs) usando como fuente de verdad un archivo 03-tasks.md.

## 1. Estructura esperada de 03-tasks.md

El archivo de tareas se llama 03-tasks.md.

Los apartados principales del trabajo se definen con líneas que empiezan por:

## N. Título del apartado

Donde:
- ## = dos almohadillas
- N = número de uno o dos dígitos (ej. 1, 2, 10), seguido de un punto (.)
- Después va un espacio y el título del apartado

Ejemplos válidos:
- ## 1. Base del proyecto y configuración
- ## 2. Modelado de dominio
- ## 10. Integración con API externa

Dentro de cada apartado puede haber tareas/subtareas con formato:

### Tarea X.Y: Título de la tarea

Donde:
- X coincide con el número de apartado (N)
- Y es el índice de la tarea dentro del apartado (1, 2, 3, ...)
- Ejemplo: ### Tarea 1.1: Crear proyecto Android

Se asume que:
- Cada apartado (## N. ...) agrupa varias tareas (Tarea N.1, Tarea N.2, etc.)
- El contenido de las tareas (listas, texto, etc.) va debajo de su cabecera

## 2. Relación entre apartados, issues, ramas, tareas y PR

Cada apartado principal (## N. Título) se mapea así:
- 1 issue de GitHub con título exactamente "N. Título"
- 1 rama Git dedicada a ese apartado
- 1 Pull Request (PR) cuando se completa el apartado

Cada tarea dentro de ese apartado:
- Vive en la misma rama de ese apartado
- Genera al menos un commit (pueden ser más, pero es deseable que sea atómico por tarea)

No se crea PR hasta que:
- Todas las tareas de ese apartado estén marcadas como hechas (según 03-tasks.md e issue)
- Se cumplan los criterios de aceptación globales del apartado

## 3. Criterios de aceptación por tarea

Para cada tarea individual (por ejemplo Tarea 1.1), antes de considerarla terminada y antes de hacer commit/push, Cursor debe verificar con el usuario los siguientes criterios:

1. No hay errores de compilación
2. Los tests relevantes pasan
3. El comando ./gradlew clean build se ejecuta correctamente (sale sin error)
4. El usuario confirma explícitamente que "funciona como quiere" (es decir, la funcionalidad se comporta según sus expectativas)

Si algunos de estos criterios NO se cumplen, esa tarea no se marca como completada y no se hace el commit/push correspondiente hasta resolverlo.

## 4. Comportamiento general de Cursor con 03-tasks.md

### 4.1. Lectura y análisis inicial de 03-tasks.md

Cuando se le indique a Cursor que use 03-tasks.md:

1. Leer el archivo completo 03-tasks.md
2. Detectar todas las líneas que cumplan el patrón: dos almohadillas ##, espacio(s), un número de uno o dos dígitos, un punto ., espacio, el resto de la línea como título del apartado
3. Para cada una de esas líneas extraer: N = número del apartado, Título = texto del apartado
4. Considerar ese apartado como una unidad de trabajo: Issue → "N. Título", Rama → feature/N-slug-del-titulo
5. Para cada apartado N, opcionalmente identificar sus tareas asociadas (líneas que contengan Tarea N.) para usarlas al crear el cuerpo del issue (checklist)

## 5. Flujo cuando el usuario dice "Empecemos la tarea X.Y"

Cuando el usuario diga algo como "Empecemos la tarea 1.1", "Quiero empezar la tarea 2.3", "Vamos con la tarea 3.2", Cursor debe seguir este flujo:

### 5.1. Identificar el apartado asociado

1. Interpretar X.Y: X = número de apartado, Y = índice de tarea dentro de ese apartado
2. En 03-tasks.md, localizar la cabecera: ## X. Título del apartado
3. Extraer el Título del apartado correspondiente
4. Reunir todas las tareas pertenecientes a ese apartado (Tarea X.1, Tarea X.2, etc.) para construir/elaborar el cuerpo del issue, si hace falta

## 6. Gestión del Issue para el apartado

### 6.1. Comprobar si el issue ya existe

Ejecutar:

gh issue list

Buscar si existe un issue con título exactamente: X. Título del apartado

Ejemplo:
- Apartado: ## 1. Base del proyecto y configuración
- Issue: 1. Base del proyecto y configuración

### 6.2. Si el issue NO existe

Crear un issue nuevo con:

gh issue create \
  --title "X. Título del apartado" \
  --body "## Descripción
[Descripción general del apartado X, opcionalmente tomada de 03-tasks.md]

## Checklist de Tareas del Apartado X
- [ ] Tarea X.1: [Título de la tarea X.1]
- [ ] Tarea X.2: [Título de la tarea X.2]
- [ ] Tarea X.3: [Título de la tarea X.3]
[Incluir TODAS las tareas que pertenecen al apartado X encontradas en 03-tasks.md]

## Criterios de Aceptación Generales para el Apartado X
- No hay errores de compilación en el proyecto
- Todos los tests relevantes pasan
- El comando \`./gradlew clean build\` se ejecuta correctamente
- El usuario confirma que la funcionalidad general del apartado X funciona como espera
"

### 6.3. Si el issue YA existe

No crear uno nuevo. Usar ese issue existente como referencia de ese apartado.

## 7. Gestión de la rama asociada al apartado

### 7.1. Nombre de la rama

La rama correspondiente al apartado ## X. Título del apartado se llamará:

feature/X-slug-del-titulo

Donde:
- X = número del apartado
- slug-del-titulo: El Título del apartado pasado a minúsculas, sin tildes ni caracteres especiales, espacios reemplazados por guiones (-)

Ejemplo:
- Apartado: ## 1. Base del proyecto y configuración
- Rama: feature/1-base-del-proyecto-y-configuracion

### 7.2. Comprobar si la rama ya existe

Ejecutar:

git branch -a

Ver si aparece feature/X-slug-del-titulo

### 7.3. Si la rama NO existe

Crear y cambiar a la rama:

git checkout -b feature/X-slug-del-titulo

### 7.4. Si la rama YA existe

Cambiar a la rama:

git checkout feature/X-slug-del-titulo

## 8. Trabajo sobre la tarea concreta X.Y

Una vez:
- El issue del apartado X está creado (o confirmado)
- La rama feature/X-slug-del-titulo está activa

Entonces Cursor debe:
1. Indicar al usuario que ya puede implementar los cambios de la tarea X.Y
2. No crear nuevas ramas ni nuevos issues para tareas individuales: todas las tareas X.Y del mismo apartado se acumulan en la misma rama y mismo issue

## 9. Verificación de criterios de aceptación por tarea

Al terminar de implementar la tarea X.Y, Cursor debe preguntar/confirmar:

1. ¿Compila el proyecto sin errores?
2. ¿Se ha ejecutado correctamente ./gradlew clean build?
3. ¿Pasan los tests relevantes?
4. ¿El usuario confirma que "funciona como quiere"?

Solo si las cuatro respuestas son "sí", se considera que la tarea X.Y está lista para commit y push.

Si alguna respuesta es "no":
- No se hace commit ni push
- Se ayuda al usuario a diagnosticar y corregir los problemas

## 10. Commit y push por tarea

Cuando la tarea X.Y cumple los criterios:

### 10.1. Commit

Usar el siguiente formato:

git add .
git commit -m "[tipo](X.Y): descripción breve"

Donde:
- X.Y identifica la tarea
- [tipo] puede ser: feat (nueva funcionalidad), fix (corrección de bug), chore (tarea de mantenimiento), refactor (refactor sin cambio funcional), docs (documentación), test (tests), style (formato)

Ejemplos:
- feat(1.1): crear proyecto Android base
- feat(1.2): añadir dependencias de red y DI
- chore(1.3): reorganizar estructura de paquetes

### 10.2. Push

Si es el primer push de esa rama:

git push -u origin feature/X-slug-del-titulo

En pushes posteriores:

git push

## 11. Actualización del issue tras cada tarea

Tras hacer commit y push de la tarea X.Y:

1. Marcar la tarea Tarea X.Y como realizada en el checklist del issue (en GitHub)
2. Si se actualiza el cuerpo por CLI:

gh issue edit [NUMERO_ISSUE] --body "[nuevo cuerpo con la tarea X.Y marcada como completada]"

3. Alternativamente, el usuario puede marcar la casilla manualmente en la interfaz web de GitHub

## 12. Creación de la Pull Request (PR) del apartado

Muy importante: La PR no se crea hasta que TODAS las tareas del apartado X estén completadas y cumplan los criterios de aceptación.

### 12.1. Condiciones previas

Antes de crear la PR del apartado X, Cursor debe confirmar con el usuario:

1. Que todas las tareas definidas en 03-tasks.md dentro del apartado ## X. ... están terminadas
2. Que:
   - No hay errores de compilación
   - ./gradlew clean build se ejecuta correctamente
   - Todos los tests relevantes pasan
   - El usuario considera que la funcionalidad global del apartado funciona como quiere

Solo entonces se procede a crear la PR.

### 12.2. Creación de la PR

Estando en la rama feature/X-slug-del-titulo:

gh pr create \
  --title "X. Título del apartado" \
  --body "## Resumen
Implementación completa del apartado X: Título del apartado.

## Tareas Completadas
- [x] Tarea X.1: [Título]
- [x] Tarea X.2: [Título]
- [x] Tarea X.3: [Título]
[Añadir todas las tareas completadas del apartado X]

## Verificación
- No hay errores de compilación
- \`./gradlew clean build\` ejecutado exitosamente
- Todos los tests relevantes pasan
- Funcionalidad revisada y aceptada por el usuario

Closes #[NUMERO_ISSUE]"

Donde:
- [NUMERO_ISSUE] es el número del issue asociado a ese apartado X
- El texto Closes #[NUMERO_ISSUE] hace que GitHub cierre automáticamente el issue al hacer merge de la PR

### 12.3. Merge de la PR

Una vez que el usuario confirma que se puede hacer merge:

gh pr merge --squash --delete-branch

Donde:
- --squash: combina todos los commits de la rama en uno solo antes de mezclar con la rama principal
- --delete-branch: elimina la rama remota después del merge

Actualizar la rama principal local:

git checkout main
git pull

## 13. Resumen del flujo completo

1. Usuario: "Empecemos la tarea X.Y"
2. Cursor:
   - Lee 03-tasks.md
   - Encuentra el apartado ## X. Título
   - Si no existe issue X. Título → lo crea con todas las tareas del apartado
   - Si no existe rama feature/X-slug-del-titulo → la crea
   - Se sitúa en feature/X-slug-del-titulo
3. Usuario implementa la tarea X.Y
4. Cursor verifica criterios:
   - Sin errores de compilación
   - ./gradlew clean build OK
   - Tests relevantes OK
   - Usuario satisfecho con el resultado
5. Si OK:
   - git add .
   - git commit -m "[tipo](X.Y): descripción breve"
   - git push (o git push -u origin ... la primera vez)
   - Marca Tarea X.Y como completada en el issue
6. Repetir 3–5 para todas las tareas del apartado X
7. Cuando todas las tareas de X estén completas:
   - Crear PR con gh pr create usando el título del apartado X
   - Incluir Closes #[NUMERO_ISSUE]
   - Hacer merge con gh pr merge --squash --delete-branch
   - Volver a main y actualizar (git checkout main, git pull)